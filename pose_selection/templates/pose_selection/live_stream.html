{% extends 'base.html' %}
{% load static %}

{% block content %}

<!--  Embedded CSS -->
<style>
    /*  YogaAI Theme Colors */
    body {
        background-color: #E8E2D0;
        /* Soft Beige */
        color: #2B3241;
        /* Deep Navy Gray */
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .header {
        background-color: #2B3241;
        /* Deep Navy Gray */
        color: #E8E2D0;
        /* Soft Beige */
        padding: 15px;
    }

    /*  Wider Video Container */
    .video-container {
        background-color: black;
        width: 100%;
        max-width: 100%;
        height: 90vh;
        /* Larger stream */
        max-height: 800px;
        /* Keep it wide on large screens */
        border-radius: 12px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .status {
        font-size: 18px;
        color: #48bb78;
        /* Green for running */
    }

    .status.not-running {
        color: #e53e3e;
        /* Red for not running */
    }

    .btn-yoga {
        background-color: #8B694D;
        /* Warm Brown */
        color: white;
        padding: 12px 24px;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .btn-yoga:hover {
        background-color: #B0A18B;
        /* Taupe */
        color: #2B3241;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .instructions {
        background-color: #2B3241;
        color: #E8E2D0;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        margin-top: 30px;
    }

    .footer {
        font-size: 14px;
        color: #B0A18B;
    }

    .footer a {
        color: #8B694D;
        text-decoration: none;
    }

    .footer a:hover {
        color: #48bb78;
    }

    /*  Responsive Design */
    @media (max-width: 1200px) {
        .video-container {
            height: 75vh;
            /* Smaller height on medium screens */
        }
    }

    @media (max-width: 768px) {
        .video-container {
            height: 60vh;
            /* Smaller height on small screens */
        }

        .btn-yoga {
            font-size: 16px;
            padding: 10px 20px;
        }
    }
</style>



<!--  Main Content -->
<main class="container py-4">

    <!--  Wide Camera Stream -->
    <div class="row">
        <div class="col-12">
            <div class="video-container" id="video-container">
                <img id="stream" src="http://127.0.0.1:8001/video" alt="YogaAI Live Stream" onerror="showBlackScreen()">

            </div>
        </div>
        <div class="col-12 text-center mt-4">
            <strong class="centre" style="font-size: 28px; color: #2B3241;">FastAPI Server Status:</strong>
            <span id="server-status" class="status" style="font-size: 28px; color: #48bb78;">Checking...</span>
        </div>
    </div>

    <!--  Pose Instructions & Feedback Below -->
    <div class="row">
        <div class="col-12">
            <div class="instructions">
                <h3 class="mb-3">Instructions</h3>
                <h5>Mountain Pose</h5>
                <p class="text-muted">Real-time guidance:</p>
                <ul>
                    <li>Stand with feet together</li>
                    <li>Arms relaxed by your sides</li>
                    <li>Shoulders back and down</li>
                    <li>Engage your core</li>
                    <li>Breathe deeply and steadily</li>
                </ul>
            </div>
        </div>
    </div>

    <!--  Control Buttons -->
    <div class="text-center my-4">
        <button class="btn btn-yoga" onclick="stopStream()">Stop Stream</button>
    </div>

</main>

{% endblock %}

{% block scripts %}
<script>
    //  Function to show black screen when server is down
    function showBlackScreen() {
        const videoContainer = document.getElementById('video-container');
        videoContainer.innerHTML = `
        <div style="width: 100%; height: 100%; background: black; display: flex; justify-content: center; align-items: center; color: white; font-size: 24px;">
            Server is not running - Please start the FastAPI server
        </div>
    `;
        document.getElementById('server-status').textContent = "Server Down";
        document.getElementById('server-status').classList.add('text-danger');
    }

    //  Function to stop the stream
    function stopStream() {
        if (confirm("Are you sure you want to stop the stream?")) {
            fetch('/stop_stream/', { method: 'GET' })
                .then(response => response.json())
                .then(data => {
                    alert("Stream stopped!");
                    window.location.href = '/';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    }

    //  Check FastAPI Server Status
    function checkServerStatus() {
        fetch('http://127.0.0.1:8001/video', { method: 'GET' })
            .then(response => {
                if (response.ok) {
                    document.getElementById('server-status').textContent = "Running";
                    document.getElementById('server-status').classList.add('text-success');
                } else {
                    showBlackScreen();
                }
            })
            .catch(() => {
                showBlackScreen();
            });
    }

    //  Check server status on page load
    window.onload = checkServerStatus;
</script>
{% endblock %}